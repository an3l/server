--echo #
--echo # MDEV 18284
--echo #

CREATE TABLE json_test(a JSON, b JSON, c JSON);
INSERT INTO json_test VALUES ("[1, 2,  3]", '{"bobj":"  foo "}', "[5 ,6 ,7 ]");

DESC json_test;

SELECT * FROM json_test;

# Test JSON_COMPACT(a)
SELECT a,JSON_COMPACT(a) FROM json_test;

# Test JSON_OBJECT()
SELECT JSON_OBJECT ("A", JSON_COMPACT(a)), JSON_OBJECT("B", JSON_COMPACT(b)), JSON_OBJECT("C", JSON_COMPACT(c)) FROM (SELECT * FROM json_test) AS derived_table;

# Test JSON_COMPACT(<derived_table.field>)
SELECT JSON_OBJECT ("A", JSON_COMPACT(derived_table.a)) FROM (SELECT * FROM json_test) AS derived_table;

# Test JSON_OBJECT on more arguments with a values as JSON_COMPACT() only
SELECT JSON_OBJECT ("A", JSON_COMPACT(a), "B", JSON_COMPACT(b)) FROM (SELECT * FROM json_test) AS derived_table;

# Test JSON_OBJECT with JSON_COMPACT and other values
SELECT JSON_OBJECT ("A", JSON_COMPACT(a), "B", b, "c", c) FROM (SELECT * FROM json_test) AS derived_table;

DROP TABLE json_test;